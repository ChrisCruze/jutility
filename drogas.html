<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Drogas</title>
    <link href="https://cruzco.site44.com/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cruzco.site44.com/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="https://cruzco.site44.com/css/animate.css" rel="stylesheet">
    <link href="https://cruzco.site44.com/css/plugins/bootstrap-markdown/bootstrap-markdown.min.css" rel="stylesheet">
    <link href='https://rawgit.com/vderm9/jutility/master/style.css' rel="stylesheet">
    <link href='https://cruzco.site44.com/lib/fullcalendar.min.css' rel='stylesheet'>
    <link href='https://cruzco.site44.com/lib/fullcalendar.print.min.css' media='print' rel='stylesheet'>
    <link href='https://cruzco.site44.com/lib/scheduler.min.css' rel='stylesheet'>
    <link href='https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css' rel='stylesheet'>
    <link href="https://cruzco.site44.com/css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/v/bs/jszip-2.5.0/dt-1.10.16/af-2.2.2/b-1.5.1/b-colvis-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/fc-3.2.4/fh-3.1.3/kt-2.3.2/r-2.2.1/rg-1.0.2/rr-1.2.3/sc-1.4.4/sl-1.2.5/datatables.min.css" rel="stylesheet" type="text/css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" type="text/css">
    <link href="https://cruzco.site44.com/css/plugins/daterangepicker/daterangepicker-bs3.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/codemirror.css" rel="stylesheet">
    <link href="https://cdn.firebase.com/libs/firepad/1.4.0/firepad.css" rel="stylesheet">
    <link href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" rel="stylesheet">
    <link href="https://cdn.rawgit.com/vderm9/jutility/master/css/editor.dataTables.min.css" rel="stylesheet">
    <link href="https://cdn.rawgit.com/ChrisCruze/jutility/master/libs/jquery.dataTables.yadcf.css" rel="stylesheet">
    <link href="css/small_chat.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.13.0/pivot.min.css" rel="stylesheet" type="text/css">
    <link href="https://cdn3.devexpress.com/jslib/18.1.6/css/dx.common.css" rel="stylesheet" type="text/css">
    <link href="https://cdn3.devexpress.com/jslib/18.1.6/css/dx.light.css" rel="stylesheet" type="text/css"><!-- Mainly scripts -->

    <script src="https://cruzco.site44.com/js/jquery-3.1.1.min.js">
    </script>
    <script src="https://cruzco.site44.com/js/bootstrap.min.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/metisMenu/jquery.metisMenu.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/slimscroll/jquery.slimscroll.min.js">
    </script><!-- Flot -->

    <script src="https://cruzco.site44.com/js/plugins/flot/jquery.flot.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/flot/jquery.flot.tooltip.min.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/flot/jquery.flot.spline.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/flot/jquery.flot.resize.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/flot/jquery.flot.pie.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/flot/jquery.flot.symbol.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/flot/curvedLines.js">
    </script><!-- Peity -->

    <script src="https://cruzco.site44.com/js/plugins/peity/jquery.peity.min.js">
    </script>
    <script src="https://cruzco.site44.com/js/demo/peity-demo.js">
    </script><!-- Custom and plugin javascript -->

    <script src="https://cruzco.site44.com/js/inspinia.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/pace/pace.min.js">
    </script><!-- jQuery UI -->

    <script src="https://cruzco.site44.com/js/plugins/jquery-ui/jquery-ui.min.js">
    </script><!-- Jvectormap -->

    <script src="https://cruzco.site44.com/js/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js">
    </script><!-- Sparkline -->

    <script src="https://cruzco.site44.com/js/plugins/sparkline/jquery.sparkline.min.js">
    </script><!-- ChartJS-->

    <script src="https://cruzco.site44.com/js/plugins/chartJs/Chart.min.js">
    </script><!-- CodeMirror-->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/codemirror.js">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/mode/javascript/javascript.js">
    </script><!-- FirebaseJS-->

    <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js">
    </script>
    <script>
    firebase.initializeApp({apiKey: "AIzaSyApJBfnH0j3TSugzEABiMFkI_tU_XXeGzg", authDomain: "shippy-ac235.firebaseapp.com", databaseURL: "https://shippy-ac235.firebaseio.com"});
    </script>
    <script src="https://cdn.firebase.com/libs/firebaseui/2.6.2/firebaseui.js">
    </script>
    <link href="https://cdn.firebase.com/libs/firebaseui/2.6.2/firebaseui.css" rel="stylesheet" type="text/css"><!-- Bootstrap markdown -->

    <script src="https://cruzco.site44.com/js/plugins/bootstrap-markdown/bootstrap-markdown.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/bootstrap-markdown/markdown.js">
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/showdown/1.8.6/showdown.min.js'>
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js">
    </script>
    <script src='https://cruzco.site44.com/lib/moment.min.js'>
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/moment-duration-format/2.2.2/moment-duration-format.min.js'>
    </script>
    <script src='http://isaaccambron.com/twix.js/twix.js/dist/twix.min.js'>
    </script>
    <script src='https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js'>
    </script>
    <script src="https://cruzco.site44.com/js/plugins/dataTables/datatables.min.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/fullcalendar/fullcalendar.min.js">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js" type="text/javascript">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js" type="text/javascript">
    </script>
    <script src="https://cdn.datatables.net/v/bs/jszip-2.5.0/dt-1.10.16/af-2.2.2/b-1.5.1/b-colvis-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/fc-3.2.4/fh-3.1.3/kt-2.3.2/r-2.2.1/rg-1.0.2/rr-1.2.3/sc-1.4.4/sl-1.2.5/datatables.min.js" type="text/javascript">
    </script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.16/api/sum().js" type="text/javascript">
    </script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.16/sorting/datetime-moment.js" type="text/javascript">
    </script>
    <script src="https://cdn.rawgit.com/vderm9/jutility/master/js/dataTables.editor.min.js" type="text/javascript">
    </script>
    <link href="https://cruzco.site44.com/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cruzco.site44.com/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="https://cruzco.site44.com/css/animate.css" rel="stylesheet">
    <link href="https://cruzco.site44.com/css/style.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js">
    </script>
    <script src="https://cdn.rawgit.com/ChrisCruze/jutility/master/libs/jquery.dataTables.yadcf.js">
    </script>
    <script src="https://cruzco.site44.com/js/plugins/daterangepicker/daterangepicker.js">
    </script>
    <script src="https://rawgit.com/vderm9/jutility/master/jutility.js">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.1.0/webcomponents-hi.js">
    </script><!-- <script src="https://rawgit.com/ChrisCruze/jutility/master/jutility.js"></script>
 -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pivottable/2.13.0/pivot.min.js" type="text/javascript">
    </script>
    <script src="https://cdn3.devexpress.com/jslib/18.1.6/js/dx.all.js" type="text/javascript">
    </script>
    <script src="jutility.js">
    </script>
</head>
<body>
    <div id="wrapper">
        <div class="gray-bg" id="page-wrapper">
            <div class="wrapper wrapper-content">
                <div id='main_content'>
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="ibox float-e-margins">
                                    <div class="ibox-title">
                                        <h5></h5>
                                        <div class="ibox-tools">
                                            <a class="collapse-link"><i class="fa fa-chevron-up"></i></a> <a class="dropdown-toggle" data-toggle="dropdown" href="#"><i class="fa fa-wrench"></i></a>
                                            <ul class="dropdown-menu dropdown-user">
                                                <li>
                                                    <a href="#" onclick="drogas_chart_update()">Ds</a>
                                                </li>
                                            </ul><a class="close-link"><i class="fa fa-times"></i></a>
                                        </div>
                                    </div>
                                    <div class="ibox-content">
                                        <form action="your-action" id="form-container" name="form-container">
                                            <div id="form"></div>
                                        </form>
                                        <table class="display nowrap" id="table" style="width:100%"></table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>



var ref = firebase.database().ref('drogas')



function drogas_array_pull(){
    url = "https://shippy-ac235.firebaseio.com/drogas.json"
    drogas_array  = firebase_json_pull_values(url)
    return drogas_array
}

function drogas_array_pull_dose_remaining(array){

    array.forEach(function(D){D['dose_remaining'] = dose_remaining_now(D)})
    sum_value = sum_float_convert_from_array_underscore(array, 'dose_remaining')
    return sum_value
}

function drogas_array_pull_with_current(form_data){
    array = drogas_array_pull()
    array.push(form_data)
    return array
}

function dose_remaining_from_combined(form_data){
    array = drogas_array_pull_with_current(form_data)
    dose_remaining = drogas_array_pull_dose_remaining(array)
    return dose_remaining
}
function form_data_firebase_prep(form_data){
    form_data['date_time'] = moment().format()
    form_data['type'] = "count"
    dose_remaining = dose_remaining_from_combined(form_data)
    form_data['within_system'] = dose_remaining
    return form_data
}

function firebase_form_data_submit(ref,form_data){
    return ref.push(form_data)
}

function form_object_submit(form_object,ref){
    form_data = form_object.option("formData")
    form_data = form_data_firebase_prep(form_data)
    firebase_form_data_submit(ref,form_data)
}

function form_object_reset_values(form_object){
    form_object.resetValues()
}

function form_object_submit_reset(form_object,ref){
    form_object_submit(form_object,ref)
    form_object_reset_values(form_object)

}
$(function() {
    form_object = $("#form").dxForm({
        //formData: employee,
        items: [ {
            itemType: "group",
            cssClass: "second-group",
            colCount: 2,
            items: [
             {
                itemType: "group",
                items: [{
                    dataField: "input_text"
                }]
            }, {
                colSpan: 2,
                dataField: "Note",
                editorType: "dxTextArea",
                editorOptions: {
                    height: 140
                }
            }]
        }, {
            itemType: "button",
            horizontalAlignment: "left",
            buttonOptions: {
                text: "Submit",
                type: "success",
                useSubmitBehavior: true
            }
        }],
        onFieldDataChanged: function(e) {
            var newFormData = e.component.option("formData");
            //console.log(newFormData)
        }
    }).dxForm("instance");

    $("#form-container").on("submit", function(e) {
        form_object_submit_reset(form_object,ref)
        DevExpress.ui.notify({
            message: "You have submitted the form",
            position: {
                my: "center top",
                at: "center top"
            }
        }, "success", 3000);
        e.preventDefault();
    });
});



function datatables_initiate() {
    function callback_function(data) {}
    params = datatables_firebase({
        firebase_reference: ref,
        table_selector: "#table",
        columns_generate: true,
        default_visible: true,
        callback_function: callback_function,
        columns: [{
            'data': 'date_time',
            'visible': true,
            format: 'date'
        }, {
            'data': 'date_time',
            'visible': false,
            format: 'date_days',
            title: 'formatted_date',
            name: 'date_days'
        }, {
            'data': 'date_time',
            'visible': false,
            title: 'month',
            name: 'month',
            render: function(data, type, row, meta) {
                return moment(data).format("MMM")
            }
        }, {
            'data': 'date_time',
            'visible': false,
            title: 'day',
            name: 'day',
            render: function(data, type, row, meta) {
                return moment(data).format("ddd")
            }
        }, {
            'data': 'date_time',
            'visible': false,
            title: 'hour',
            name: 'hour',
            render: function(data, type, row, meta) {
                return moment(data).format("HH")
            }
        }, {
            'data': 'input_text',
            'visible': true,
            format: 'text'
        }, {
            'data': 'type',
            'visible': true,
            format: 'text'
        }, {
            'data': 'within_system',
            'visible': false,
            format: 'text'
        }, ],
        firebase_limit: 100,
        sort: 'date_time',
        //callback_function:visits_callback,
    })
    return params
}
datatables_initiate()
replace_side_panel_platform_omni()

    </script>
</body>
</html>