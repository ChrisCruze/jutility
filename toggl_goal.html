<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cruz Control</title>
<link href="https://cruz.site44.com/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cruz.site44.com/font-awesome/css/font-awesome.css" rel="stylesheet">
<link href="https://cruz.site44.com/css/animate.css" rel="stylesheet">
<link href=https://rawgit.com/vderm9/jutility/master/style.css rel="stylesheet">
<link href='https://cruzco.site44.com/lib/fullcalendar.min.css' rel='stylesheet' />
<link href='https://cruzco.site44.com/lib/fullcalendar.print.min.css' rel='stylesheet' media='print' />
<link href='https://cruzco.site44.com/lib/scheduler.min.css' rel='stylesheet' />
<link href='https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css' rel='stylesheet' />
<link href="https://cruz.site44.com/css/plugins/dataTables/datatables.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/jszip-2.5.0/dt-1.10.16/af-2.2.2/b-1.5.1/b-colvis-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/fc-3.2.4/fh-3.1.3/kt-2.3.2/r-2.2.1/rg-1.0.2/rr-1.2.3/sc-1.4.4/sl-1.2.5/datatables.min.css"/>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/codemirror.css" />
<link rel="stylesheet" href="https://cdn.firebase.com/libs/firepad/1.4.0/firepad.css" />
<link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css">
<link rel="stylesheet" href="https://cdn.rawgit.com/vderm9/jutility/master/css/editor.dataTables.min.css">
<!-- Mainly scripts -->
<script src="https://cruz.site44.com/js/jquery-3.1.1.min.js"></script>
<script src="https://cruz.site44.com/js/bootstrap.min.js"></script>
<script src="https://cruz.site44.com/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="https://cruz.site44.com/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Flot -->
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.spline.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.resize.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.pie.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.symbol.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/curvedLines.js"></script>

<!-- Peity -->
<script src="https://cruz.site44.com/js/plugins/peity/jquery.peity.min.js"></script>
<script src="https://cruz.site44.com/js/demo/peity-demo.js"></script>

<!-- Custom and plugin javascript -->
<script src="https://cruz.site44.com/js/inspinia.js"></script>
<script src="https://cruz.site44.com/js/plugins/pace/pace.min.js"></script>

<!-- jQuery UI -->
<script src="https://cruz.site44.com/js/plugins/jquery-ui/jquery-ui.min.js"></script>

<!-- Jvectormap -->
<script src="https://cruz.site44.com/js/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
<script src="https://cruz.site44.com/js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>

<!-- Sparkline -->
<script src="https://cruz.site44.com/js/plugins/sparkline/jquery.sparkline.min.js"></script>

<!-- ChartJS-->
<script src="https://cruz.site44.com/js/plugins/chartJs/Chart.min.js"></script>

<!-- CodeMirror-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/codemirror.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/mode/javascript/javascript.js"></script>

<!-- FirebaseJS-->
<script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
<script>
firebase.initializeApp({apiKey: "AIzaSyApJBfnH0j3TSugzEABiMFkI_tU_XXeGzg", authDomain: "shippy-ac235.firebaseapp.com", databaseURL: "https://shippy-ac235.firebaseio.com"});
</script>
<script src="https://cdn.firebase.com/libs/firebaseui/2.6.2/firebaseui.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.6.2/firebaseui.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src='https://cruzco.site44.com/lib/moment.min.js'></script>
<script src='http://isaaccambron.com/twix.js/twix.js/dist/twix.min.js'></script>
<script src='https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js'></script>
<script src="https://cruz.site44.com/js/plugins/dataTables/datatables.min.js"></script>
<script src="https://cruzco.site44.com/js/plugins/fullcalendar/fullcalendar.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs/jszip-2.5.0/dt-1.10.16/af-2.2.2/b-1.5.1/b-colvis-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/fc-3.2.4/fh-3.1.3/kt-2.3.2/r-2.2.1/rg-1.0.2/rr-1.2.3/sc-1.4.4/sl-1.2.5/datatables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.16/api/sum().js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.16/sorting/datetime-moment.js"></script>
<script type="text/javascript" src="https://cdn.rawgit.com/vderm9/jutility/master/js/dataTables.editor.min.js"></script>
<link href="https://cruz.site44.com/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cruz.site44.com/font-awesome/css/font-awesome.css" rel="stylesheet">
<link href="https://cruz.site44.com/css/animate.css" rel="stylesheet">
<link href="https://cruz.site44.com/css/style.css" rel="stylesheet">
<script src="https://rawgit.com/vderm9/jutility/master/jutility.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.1.0/webcomponents-hi.js"></script>
<script src="https://rawgit.com/ChrisCruze/jutility/master/jutility.js"></script>
<!-- <script src="jutility.js"></script>
 -->
</head>

<body>
  <div class="row" id="metric_headers">
  </div>


  <div class='ibox-content'>
      <table id="table" class="table table-striped table-bordered table-hover dataTables-example">
       </table>
  </div>

 <script>


function headers_create(){
	$('#metric_headers').append(metric_header_create('Count','Toggl Tasks',"-","-"))
	$('#metric_headers').append(metric_header_create('Cost','Dollars',"-","-"))
	$('#metric_headers').append(metric_header_create('Hours','Hours',"-","-"))
	$('#metric_headers').append(metric_header_create('Goal','Goal: 100 (06/08)',"-","-"))

}


function metric_headers_update_list(callback_array,l){
  $("."+'Count').find(".metric_text").html(callback_array.length)

  $("."+'Hours').find(".metric_text").html(sum_float_convert_from_array_underscore(callback_array,'hours').toFixed(2))
  $("."+'Cost').find(".metric_text").html(sum_float_convert_from_array_underscore(callback_array,'cost').toFixed(2))


  $("."+'Goal').find(".metric_text").html((callback_array.length/100)*100 + "%")
  $("."+'Goal').find(".sub_metric_text").html(100-callback_array.length + " Remaining")

}


headers_create()

omni_node = 'toggl_tasks'
var dbRef = dbRef||firebase.database();
var FirebaseRef = dbRef.ref('omni').child(omni_node)


$.fn.dataTable.ext.type.order["date-format-moment-pre"] = function(d) {
  r = moment(d).utc();
  return r;
};


function array_dictionary_customize(item, index) {
  item["DT_RowId"] = item.id;
}





array =toggl_data_pull_custom('2018-05-30')
array.forEach(array_dictionary_customize);
array = firebase_array_integrate(array,"https://shippy-ac235.firebaseio.com/omni/"+omni_node+".json","DT_RowId",['status','notes'])

 json_prettify(array)

editor = new $.fn.dataTable.Editor({
  table: "#table",
  fields: [{ label: "status:", name: "status" },{ label: "notes:", name: "notes" }]
});

editor.on("postSubmit", function(e, json, data, action, xhr) {
  json_array = json.data;
  json_array.forEach(function(D) {
    record_id = D["DT_RowId"];
    D["timestamp"] = moment().format();
    FirebaseRef.child(record_id).set(D);
  });
});

//based on filter from table , update a funciton
function callback_function() {
  var api = this.api();
  callback_array = api.rows({ page: "current" }).data();
  metric_headers_update_list(callback_array)



}

$("#table").DataTable({
  paging: false,
  dom: '<"html5buttons"B>lTfgitp',
  data: array,
  columns: [
    {
      data: "description",
      title: "description",
      visible: true,
      name: "description"
    },
    {
      data: "start",
      title: "start",
      visible: true,
      name: "start",
      createdCell: date_time_datatable_format,
      type: "date-format-moment"
    },
     {
      data: "end",
      title: "end",
      visible: true,
      name: "end",
      createdCell: date_time_datatable_format,
      type: "date-format-moment"
    },
    {
      data: "cost",
      title: "cost",
      visible: true,
      name: "cost",
      createdCell: parse_float_datatable_format
    },
    {
      data: "minutes",
      title: "minutes",
      visible: true,
      name: "minutes",
      createdCell: parse_float_datatable_format
    },
    {
      data: "hours",
      title: "hours",
      visible: false,
      name: "hours",
      createdCell: parse_float_datatable_format
    },
    {
      data: "dur",
      title: "dur",
      visible: false,
      name: "dur"
    },
    {
      data: "user",
      title: "user",
      visible: false,
      name: "user"
    },
    {
      data: "status",
      title: "status",
      visible: true,
      name: "status"
    },
    {
      data: "notes",
      title: "notes",
      visible: true,
      name: "notes"
    }
  ],
  select: true,
  colReorder: true,
  drawCallback: callback_function,
  buttons: [
    { extend: "excel", title: document.title },
    { extend: "colvis", title: document.title },
    { extend: "edit", editor: editor },
    {text: 'Clear',name:'Clear', action: function ( e, dt, node, config ) {
      dt.columns('').search('').draw()
    }}
  ],
  order: [1, "desc"]
});





 </script>
</body>
</html>