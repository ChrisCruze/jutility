<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookmark</title>
<link href="https://cruz.site44.com/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cruz.site44.com/font-awesome/css/font-awesome.css" rel="stylesheet">
<link href="https://cruz.site44.com/css/animate.css" rel="stylesheet">
<link href=https://rawgit.com/vderm9/jutility/master/style.css rel="stylesheet">
<link href='https://cruzco.site44.com/lib/fullcalendar.min.css' rel='stylesheet' />
<link href='https://cruzco.site44.com/lib/fullcalendar.print.min.css' rel='stylesheet' media='print' />
<link href='https://cruzco.site44.com/lib/scheduler.min.css' rel='stylesheet' />
<link href='https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css' rel='stylesheet' />
<link href="https://cruz.site44.com/css/plugins/dataTables/datatables.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/jszip-2.5.0/dt-1.10.16/af-2.2.2/b-1.5.1/b-colvis-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/fc-3.2.4/fh-3.1.3/kt-2.3.2/r-2.2.1/rg-1.0.2/rr-1.2.3/sc-1.4.4/sl-1.2.5/datatables.min.css"/>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/codemirror.css" />
<link rel="stylesheet" href="https://cdn.firebase.com/libs/firepad/1.4.0/firepad.css" />
<link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css">
<link rel="stylesheet" href="https://cdn.rawgit.com/vderm9/jutility/master/css/editor.dataTables.min.css">
<!-- Mainly scripts -->
<script src="https://cruz.site44.com/js/jquery-3.1.1.min.js"></script>
<script src="https://cruz.site44.com/js/bootstrap.min.js"></script>
<script src="https://cruz.site44.com/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="https://cruz.site44.com/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Flot -->
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.tooltip.min.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.spline.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.resize.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.pie.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/jquery.flot.symbol.js"></script>
<script src="https://cruz.site44.com/js/plugins/flot/curvedLines.js"></script>

<!-- Peity -->
<script src="https://cruz.site44.com/js/plugins/peity/jquery.peity.min.js"></script>
<script src="https://cruz.site44.com/js/demo/peity-demo.js"></script>

<!-- Custom and plugin javascript -->
<script src="https://cruz.site44.com/js/inspinia.js"></script>
<script src="https://cruz.site44.com/js/plugins/pace/pace.min.js"></script>

<!-- jQuery UI -->
<script src="https://cruz.site44.com/js/plugins/jquery-ui/jquery-ui.min.js"></script>

<!-- Jvectormap -->
<script src="https://cruz.site44.com/js/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js"></script>
<script src="https://cruz.site44.com/js/plugins/jvectormap/jquery-jvectormap-world-mill-en.js"></script>

<!-- Sparkline -->
<script src="https://cruz.site44.com/js/plugins/sparkline/jquery.sparkline.min.js"></script>

<!-- ChartJS-->
<script src="https://cruz.site44.com/js/plugins/chartJs/Chart.min.js"></script>

<!-- CodeMirror-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/codemirror.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/mode/javascript/javascript.js"></script>

<!-- FirebaseJS-->
<script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
<script>
firebase.initializeApp({apiKey: "AIzaSyApJBfnH0j3TSugzEABiMFkI_tU_XXeGzg", authDomain: "shippy-ac235.firebaseapp.com", databaseURL: "https://shippy-ac235.firebaseio.com"});
</script>
<script src="https://cdn.firebase.com/libs/firebaseui/2.6.2/firebaseui.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.6.2/firebaseui.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
<script src='https://cruzco.site44.com/lib/moment.min.js'></script>
<script src='http://isaaccambron.com/twix.js/twix.js/dist/twix.min.js'></script>
<script src='https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js'></script>
<script src="https://cruz.site44.com/js/plugins/dataTables/datatables.min.js"></script>
<script src="https://cruzco.site44.com/js/plugins/fullcalendar/fullcalendar.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs/jszip-2.5.0/dt-1.10.16/af-2.2.2/b-1.5.1/b-colvis-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/fc-3.2.4/fh-3.1.3/kt-2.3.2/r-2.2.1/rg-1.0.2/rr-1.2.3/sc-1.4.4/sl-1.2.5/datatables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.16/api/sum().js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.16/sorting/datetime-moment.js"></script>
<script type="text/javascript" src="https://cdn.rawgit.com/vderm9/jutility/master/js/dataTables.editor.min.js"></script>
<link href="https://cruz.site44.com/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cruz.site44.com/font-awesome/css/font-awesome.css" rel="stylesheet">
<link href="https://cruz.site44.com/css/animate.css" rel="stylesheet">
<link href="https://cruz.site44.com/css/style.css" rel="stylesheet">
<script src="https://rawgit.com/vderm9/jutility/master/jutility.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.1.0/webcomponents-hi.js"></script>
<script src="https://rawgit.com/ChrisCruze/jutility/master/jutility.js"></script>

</head>

<body>

<div id="wrapper">
<div id="page-wrapper2" class="gray-bg" style="min-height: 305px;">

<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
    <h2>Bookmarks</h2>
    </div>
</div>


<div class="wrapper wrapper-content animated fadeInRight">



    <div class="row">
    <div class="col-lg-12">
    <div class="ibox float-e-margins">
    <div class="ibox-content">

    <div class="row" id="target">

  
    </div>
    </div>
    </div>
    </div>
    </div>

    <div class="row">
    <div class="col-lg-12">
    <div class="ibox float-e-margins">
    <div class="ibox-content">

    <div class="row">
    <table id="table" class="display" cellspacing="0" width="100%">
    </table>
  
    </div>
    </div>
    </div>
    </div>
    </div>

    <div class="row">

<div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>Input</h5>
                            <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                    <i class="fa fa-wrench"></i>
                                </a>
                                <a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <form class="form-horizontal">
                                <div class="form-group"><label class="col-lg-2 control-label">Name</label>
                                    <div class="col-lg-10">
                                      <input type="file" capture="camera" accept="image/*" id="cameraInput" name="cameraInput">

                                    </div>
                                </div>



                                </div>

                                <div class="form-group"><label class="col-lg-2 control-label">Favicon</label>
                                    <div class="col-lg-10"><input id='favicon' placeholder="favicon" class="form-control" type="text"></div>
                                </div>
                                <div class="form-group">
                                    <div class="col-lg-offset-2 col-lg-10">
                                        <button class="btn btn-sm btn-white" type="submit" id='input_submit'>Submit</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
</div>
</div>
</div>
</div>



<script>



var dbRef = firebase.database();
var firebaseRef = dbRef.ref('cruz_control').child('food');
fields = ['title','url','favicon']




$('.favicon_select').on('click', function (e) {
    $("#favicon_select_button").html($(this))
})

// //push data about the checkbox to firebase
// $("#input_submit").click(function(event) {
//     event.preventDefault()
//     r = firebaseRef.push(
//         {'title':$("#title").val(),
//         'url':$("#url").val(),
//         'favicon':'glyphicon glyphicon-grain',//$("#favicon_select_button").find('.glyphicon').attr('class'),//$("#favicon").val(),
//         'time_stamp':moment().format()})
//     console.log(r)
//     $("#title").val("")
//     $("#url").val("")
//     $("#favicon").val("")

// });




editor = new $.fn.dataTable.Editor({
  table: "#table",
  idSrc:  'DT_RowId',
  fields: [{ label: "title:", name: "title" },{ label: "url:", name: "url" },{ label: "favicon:", name: "favicon" }]
});

editor.on("postSubmit", function(e, json, data, action, xhr) {
  json_array = json.data;
  json_array.forEach(function(D) {
    record_id = D["DT_RowId"];
    D["time_stamp"] = moment().format();
    firebaseRef.child(record_id).set(D);
  });
});



table = $('#table').DataTable({
            paging:false,
            dom: '<"html5buttons"B>lTfgitp',
            data: [],
            columns: [
                {data:'url',title:'url',visible:false,name:'url'},
                {data:'time_stamp',title:'time_stamp',visible:true,name:'time_stamp'},
                {data:'DT_RowId',title:'DT_RowId',visible:true,name:'DT_RowId'}
            ],
            select: true,
            colReorder: true,
            buttons: [
                { extend: "excel", title: document.title },
                { extend: "colvis", title: document.title },
                { extend: "edit", editor: editor },
                {text: 'Clear',name:'Clear', action: function ( e, dt, node, config ) {
                  dt.columns('').search('').draw()
                }}]
        });


function openInNewTab(url) {
  var win = window.open(url, '_blank');
  win.focus();
}

function add_bookmark_div(url,i){
    url = url||"https://cruz.site44.com/profile.html"
    var outer_div = $("<div>", {"class": "col-md-1"});
    var inner_div = $("<div>", {"class": "contact-box center-version"});
    //var link_elem = $("<a>", {"href": url,"target":"_blank","id":id});

    var link_elem = $("<img>", {"src":url, "height":"100" ,"width":"100" });

    //var image_elem = $("<img>", {"src": image_url});
    // var image_elem = $("<i>", {"class": icon_class}).text(count);
    // var text_elem = $("<h3>", {"class": "m-b-xs"}).text(title_text)
    //var final_div = link_elem.append(image_elem).append(text_elem)
    var final_div = inner_div.append(link_elem)
    var final_div = outer_div.append(final_div)
    $("#target").append(final_div)



    return final_div
}




firebaseRef.on("child_added", function(snap) {
    directory_addresses = snap.getRef().path.n
    id = directory_addresses[directory_addresses.length-1]

    firebase_dictionary = snap.val()
    firebase_dictionary['DT_RowId'] = id
    table.row.add(firebase_dictionary).draw(false);
    add_bookmark_div(firebase_dictionary.url,firebase_dictionary.time_stamp)
})



const fileInput = document.getElementById('cameraInput');

function doSomethingWithFiles(i){

  encodeImageFileAsURL(i)
  console.log(i)
}

function encodeImageFileAsURL(files) {
  var file = files[0];
  var reader = new FileReader();
  reader.onloadend = function() {


      r = firebaseRef.push(
        {'url':reader.result,
        'time_stamp':moment().format()})




    //$("#image_source").attr("src",reader.result)
  }
  reader.readAsDataURL(file);
}


  fileInput.addEventListener('change', (e) => doSomethingWithFiles(e.target.files));


</script>















</div>
</body>

</html>